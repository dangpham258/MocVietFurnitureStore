<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>

    <div th:fragment="productCard(product)" class="card h-100 product-card shadow-sm border-0 overflow-hidden">
        <a th:href="@{/products/{slug}(slug=${product.slug})}" class="text-decoration-none">
            <img th:if="${product.thumbnailUrl != null 
                           and (#strings.startsWith(product.thumbnailUrl, '/') 
                                or (#strings.startsWith(product.thumbnailUrl, 'http') 
                                    and !#strings.contains(product.thumbnailUrl, 'via.placeholder.com')))}"
                 th:src="${product.thumbnailUrl}"
                 class="card-img-top"
                 th:alt="${product.name}"
                 style="height: 250px; object-fit: cover;">
            <div th:unless="${product.thumbnailUrl != null 
                               and (#strings.startsWith(product.thumbnailUrl, '/') 
                                    or (#strings.startsWith(product.thumbnailUrl, 'http') 
                                        and !#strings.contains(product.thumbnailUrl, 'via.placeholder.com')))}"
                 class="card-img-top bg-light d-flex align-items-center justify-content-center"
                 style="height: 250px;">
                <span class="text-muted">Không có ảnh</span>
            </div>
        </a>
        <div class="card-body d-flex flex-column p-3">
            <h6 class="card-title mb-1 flex-grow-0">
                <a th:href="@{/products/{slug}(slug=${product.slug})}"
                   class="text-dark text-decoration-none"
                   th:title="${product.name}"
                   style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; min-height: 2.4em;"
                   th:text="${product.name}">
                   Tên sản phẩm dài để kiểm tra cắt dòng
                </a>
            </h6>
            <div class="d-flex align-items-center mb-2 small text-muted flex-grow-0">
                 <span th:if="${product.avgRating > 0}" class="text-warning me-1">
                     <i class="bi bi-star-fill"></i> <span th:text="${#numbers.formatDecimal(product.avgRating, 1, 1)}"></span>
                 </span>
                 <span th:if="${product.avgRating == 0}" class="me-1">
                     <i class="bi bi-star"></i> N/A
                 </span>
                 <span>(<span th:text="${product.totalReviews}">0</span> đánh giá)</span>
            </div>
            <div class="mt-auto pt-2"> <p class="card-text fw-bold mb-0">
                    <span class="text-danger fs-5" th:text="${#numbers.formatDecimal(product.salePrice, 0, 'POINT', 0, 'COMMA') + ' đ'}"></span>
                </p>
                 <p class="card-text" th:if="${product.discountPercent > 0}">
                     <span class="text-muted text-decoration-line-through small me-2"
                           th:text="${#numbers.formatDecimal(product.originalPrice, 0, 'POINT', 0, 'COMMA') + ' đ'}"></span>
                     <span class="badge bg-danger" th:text="'-' + ${product.discountPercent} + '%'"></span>
                 </p>
                 <p class="card-text" th:unless="${product.discountPercent > 0}" style="height: 24px;"> &nbsp;
                 </p>
            </div>
        </div>
        </div>

</body>
</html>